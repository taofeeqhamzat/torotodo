<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Toro - Task Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'bg': '#0f172a',
            'card': '#111827',
            'text': '#f1f5f9',
            'muted': '#94a3b8',
            'accent': '#3b82f6',
            'accent-hover': '#2563eb',
            'danger': '#ef4444',
            'danger-hover': '#dc2626',
            'border': '#1e293b',
            'border-light': '#334155',
          }
        }
      }
    }
  </script>
  <style>
    body {
      font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #0b1223 0%, #0f172a 50%, #0a0f1c 100%);
      min-height: 100vh;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-fade-in {
      animation: fadeIn 0.6s ease-out;
    }

  </style>
</head>

<body>
  <div class="max-w-2xl mx-auto my-16 px-5 md:my-16 my-5 md:px-5 px-4">
    <div class="bg-card border border-border rounded-2xl p-8 md:p-8 p-6 shadow-2xl backdrop-blur-sm animate-fade-in" role="application" aria-label="Todo app">
      <header class="mb-8">
        <h1 class="text-3xl font-bold mb-3 bg-gradient-to-r from-text to-muted bg-clip-text text-transparent">Toro</h1>
        <div class="text-muted text-base leading-relaxed">Your personal task manager</div>
      </header>

      <section class="mb-6">
        <div class="flex gap-3 items-center md:flex-row flex-col">
          <input id="newTodo" type="text" placeholder="What needs to be done?" aria-label="New todo" 
                 class="flex-1 px-4 py-3.5 rounded-xl border border-border-light bg-slate-900/80 text-text text-base transition-all duration-200 focus:outline-none focus:border-accent focus:ring-3 focus:ring-accent/10 placeholder:text-muted w-full" />
          <button id="addBtn" aria-label="Add todo" 
                  class="px-5 py-3.5 rounded-xl bg-accent text-white font-semibold text-sm cursor-pointer transition-all duration-200 hover:bg-accent-hover hover:-translate-y-0.5 whitespace-nowrap md:w-auto w-full">Add Task</button>
        </div>
      </section>

      <section class="mb-5">
        <div class="flex gap-2 flex-wrap" role="tablist" aria-label="Filters">
          <span class="pill active px-4 py-2 rounded-full border border-accent text-accent bg-accent/15 cursor-pointer text-sm font-medium transition-all duration-200" data-filter="all" role="tab" aria-selected="true">All</span>
          <span class="pill px-4 py-2 rounded-full border border-border-light cursor-pointer text-muted text-sm font-medium transition-all duration-200 hover:bg-accent/10 hover:border-accent hover:text-accent" data-filter="active" role="tab" aria-selected="false">Active</span>
          <span class="pill px-4 py-2 rounded-full border border-border-light cursor-pointer text-muted text-sm font-medium transition-all duration-200 hover:bg-accent/10 hover:border-accent hover:text-accent" data-filter="completed" role="tab" aria-selected="false">Completed</span>
          <span class="pill px-4 py-2 rounded-full border border-border-light cursor-pointer text-muted text-sm font-medium transition-all duration-200 hover:bg-accent/10 hover:border-accent hover:text-accent" data-action="clearCompleted" title="Remove all completed">Clear Completed</span>
        </div>
      </section>

      <section class="min-h-[100px]">
        <ul id="list" aria-live="polite" class="list-none m-0 p-0 mt-6"></ul>
      </section>

      <footer class="flex justify-between items-center mt-6 pt-5 border-t border-border text-muted text-sm md:flex-row flex-col gap-3 text-center">
        <div class="font-medium">
          <span id="count">0</span> tasks • <span id="storage"></span>
        </div>
        <div class="text-xs opacity-80">
          <span class="kbd px-2 py-1 border border-border-light rounded text-xs text-muted bg-slate-900/50">Enter</span> to add •
        </div>
      </footer>

      <section class="mt-6 pt-5 border-t border-border">
        <div class="flex gap-2 flex-wrap">
          <button class="ghost px-4 py-2 rounded-xl bg-transparent text-muted border border-border-light cursor-pointer transition-all duration-200 hover:bg-accent/10 hover:text-accent hover:border-accent" id="exportBtn" title="Export as JSON">Export</button>
          <button class="ghost px-4 py-2 rounded-xl bg-transparent text-muted border border-border-light cursor-pointer transition-all duration-200 hover:bg-accent/10 hover:text-accent hover:border-accent" id="importBtn" title="Import from JSON">Import</button>
          <input type="file" id="fileInput" accept="application/json" hidden />
        </div>
      </section>
    </div>
  </div>

  <script>
    $(document).ready(function() {
      // --- Storage & State ------------------------------------------------------
      const LS_KEY = "todos.v1";
      const state = {
        filter: "all",
        todos: load()
      };

      // --- Utility Functions ---------------------------------------------------
      function uid() {
        return Math.random().toString(36).slice(2) + Date.now().toString(36);
      }

      function load() {
        try {
          const raw = localStorage.getItem(LS_KEY);
          return raw ? JSON.parse(raw) : [];
        } catch { 
          return []; 
        }
      }

      function save() {
        localStorage.setItem(LS_KEY, JSON.stringify(state.todos));
        updateStorageInfo();
      }

      function updateStorageInfo() {
        const bytes = new Blob([localStorage.getItem(LS_KEY) || ""]).size;
        const kb = (bytes / 1024).toFixed(1);
        $("#storage").text(`${kb} KB used`);
      }

      // --- CRUD Operations -----------------------------------------------------
      function addTodo(title) {
        title = (title || "").trim();
        if (!title) return;
        
        state.todos.push({ 
          id: uid(), 
          title, 
          completed: false, 
          createdAt: Date.now() 
        });
        save();
        render();
      }

      function toggleTodo(id) {
        const todo = state.todos.find(t => t.id === id);
        if (todo) {
          todo.completed = !todo.completed;
          save();
          render();
        }
      }

      function deleteTodo(id) {
        state.todos = state.todos.filter(t => t.id !== id);
        save();
        render();
      }

      function updateTodo(id, title) {
        const todo = state.todos.find(t => t.id === id);
        if (todo) {
          todo.title = title.trim();
          save();
          render();
        }
      }

      function clearCompleted() {
        state.todos = state.todos.filter(t => !t.completed);
        save();
        render();
      }

      // --- Rendering -----------------------------------------------------------
      function getFiltered() {
        switch (state.filter) {
          case "active": return state.todos.filter(t => !t.completed);
          case "completed": return state.todos.filter(t => t.completed);
          default: return state.todos;
        }
      }

      function createTodoItem(todo) {
        const $li = $(`
          <li class="flex items-center gap-3 py-4 border-b border-border transition-all duration-200 hover:bg-accent/5 hover:rounded-lg hover:mx-[-8px] hover:px-2 ${todo.completed ? 'opacity-75' : ''}" data-id="${todo.id}">
            <label class="flex-1 flex items-center gap-3 cursor-pointer">
              <input type="checkbox" class="w-5 h-5 accent-accent cursor-pointer" ${todo.completed ? 'checked' : ''}>
              <span class="flex-1 text-base leading-relaxed ${todo.completed ? 'text-muted line-through' : 'text-text'}">${todo.title}</span>
            </label>
            <button class="w-6 h-6 md:w-6 md:h-6 w-7 h-7 rounded-full bg-transparent text-muted border border-transparent flex items-center justify-center text-base md:text-base text-lg opacity-60 md:opacity-60 opacity-50 transition-all duration-200 hover:bg-danger/10 hover:text-danger hover:border-danger hover:opacity-100 hover:scale-110 md:hover:scale-110 hover:scale-115" title="Delete task">×</button>
          </li>
        `);

        // Event handlers
        $li.find('input[type="checkbox"]').on('change', () => toggleTodo(todo.id));
        $li.find('button').on('click', () => deleteTodo(todo.id));
        
        // Inline editing
        $li.find('span').on('dblclick', function() {
          const $span = $(this);
          const $input = $(`<input class="flex-1 px-3 py-2 rounded-lg border border-accent bg-slate-900/90 text-text text-base" value="${todo.title}">`);
          
          $span.replaceWith($input);
          $input.focus().select();
          
          const commit = () => {
            const val = $input.val().trim();
            if (val) {
              updateTodo(todo.id, val);
            } else {
              deleteTodo(todo.id);
            }
          };
          
          $input.on('keydown', function(e) {
            if (e.key === 'Enter') commit();
            if (e.key === 'Escape') render();
          }).on('blur', commit);
        });

        return $li;
      }

      function render() {
        const $list = $("#list");
        $list.empty();
        
        getFiltered().forEach(todo => {
          $list.append(createTodoItem(todo));
        });
        
        $("#count").text(state.todos.length);
        
        // Update filter pills
        $(".pill[role='tab']").each(function() {
          const $pill = $(this);
          const isActive = $pill.data('filter') === state.filter;
          
          $pill.removeClass('active')
               .attr('aria-selected', isActive);
               
          if (isActive) {
            $pill.addClass('active px-4 py-2 rounded-full border border-accent text-accent bg-accent/15 cursor-pointer text-sm font-medium transition-all duration-200');
          } else {
            $pill.addClass('px-4 py-2 rounded-full border border-border-light cursor-pointer text-muted text-sm font-medium transition-all duration-200 hover:bg-accent/10 hover:border-accent hover:text-accent');
          }
        });
      }

      // --- Import/Export --------------------------------------------------------
      function exportJSON() {
        const blob = new Blob([JSON.stringify(state.todos, null, 2)], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const $a = $('<a>').attr({ href: url, download: "todos.json" });
        $('body').append($a);
        $a[0].click();
        $a.remove();
        URL.revokeObjectURL(url);
      }

      function importJSON(file) {
        const reader = new FileReader();
        reader.onload = function(e) {
          try {
            const arr = JSON.parse(e.target.result);
            if (!Array.isArray(arr)) throw new Error("Invalid JSON format");
            
            // Normalize imported data
            state.todos = arr.map(t => ({
              id: t.id || uid(),
              title: String(t.title || "").trim(),
              completed: !!t.completed,
              createdAt: Number(t.createdAt || Date.now())
            })).filter(t => t.title);
            
            save();
            render();
          } catch (err) {
            alert("Import failed: " + err.message);
          }
        };
        reader.readAsText(file);
      }

      // --- Event Handlers ------------------------------------------------------
      $("#addBtn").on('click', function() {
        const title = $("#newTodo").val();
        addTodo(title);
        $("#newTodo").val('').focus();
      });

      $("#newTodo").on('keydown', function(e) {
        if (e.key === 'Enter') {
          const title = $(this).val();
          addTodo(title);
          $(this).val('');
        }
      });

      $(".pill").on('click', function() {
        const $pill = $(this);
        const filter = $pill.data('filter');
        const action = $pill.data('action');
        
        if (filter) {
          state.filter = filter;
          render();
        } else if (action === 'clearCompleted') {
          clearCompleted();
        }
      });

      $("#exportBtn").on('click', exportJSON);
      
      $("#importBtn").on('click', function() {
        $("#fileInput").click();
      });
      
      $("#fileInput").on('change', function(e) {
        const file = e.target.files[0];
        if (file) {
          importJSON(file);
          $(this).val(''); // Reset file input
        }
      });

      // --- Bootstrap ------------------------------------------------------------
      // Only seed initial data for first-time users (when localStorage has never been initialized)
      const hasBeenInitialized = localStorage.getItem(LS_KEY) !== null;
      if (state.todos.length === 0 && !hasBeenInitialized) {
        // Seed initial data for workshop
        state.todos = [
          { 
            id: uid(), 
            title: "Explore the app", 
            completed: true, 
            createdAt: Date.now() - 86400000 
          },
          { 
            id: uid(), 
            title: "Post a Tweet about #GoogleCloudRoadshow", 
            completed: false, 
            createdAt: Date.now() 
          },          
          { 
            id: uid(), 
            title: "Call Uncle Bob", 
            completed: false, 
            createdAt: Date.now() 
          }
        ];
        save();
      }
      
      updateStorageInfo();
      render();
    });
  </script>
</body>

</html>